import{u as _,a as D,p as T,r as F,d as L,b as $,c as S,e as n,f as o,w as d,v as p,n as c,t as i,g as m,F as q,h as V,i as w,j,k as f,l as K,m as M,o as r,q as N}from"./index-B5qpgIxp.js";import{u as Q}from"./index-Cokfy_eI.js";import{u as A}from"./useMutation-B7kydQLG.js";import{u as B}from"./useColonies-Bt64ig_1.js";import{u as E}from"./useAvailableTopics-DXRP8wLZ.js";import{g as I,a as C}from"./getDateTimeForInput-BOWwtIe8.js";function J(){const g=_();return A({mutationFn:async({person:u,returnVisit:s})=>{var b;const y={colony:u.colony.trim(),name:u.name.trim(),description:u.description.trim(),location:u.location},h=await D("people",y),v=s&&h!=null?{personId:h,date:s.date,topic:s.topic.trim(),returnDate:s.returnDate,notes:(b=s.notes)==null?void 0:b.trim()}:void 0,e=v?await D("returnVisits",v):void 0;return{person:{id:h,...y},returnVisit:e&&v?v:void 0}},onSuccess:({person:u,returnVisit:s})=>{g.invalidateQueries({queryKey:T.all()}),g.setQueryData(T.detail(u.id),u),s&&(g.invalidateQueries({queryKey:F.list(u.id)}),g.setQueryData(F.detail(s.personId,s.date),s))}})}const R={class:"max-w-prose mx-auto py-2 px-3"},z={class:"col-span-2"},G={key:0,class:"text-chili-600"},O={class:"col-span-2"},H={key:0,class:"text-chili-600"},W={id:"colonyList"},X={class:"col-span-2 self-center"},Y={key:0,class:"text-chili-600"},Z={class:"col-span-2"},ee=["placeholder"],te={key:0,class:"text-chili-600"},ae={class:"col-span-2"},oe={class:"flex flex-wrap gap-2"},le={key:0,class:"text-chili-600"},ne={key:0},re={class:"col-span-2"},se={key:0,class:"text-chili-600"},ie={id:"topicDataList"},ue={class:"col-span-2"},de={class:"flex flex-wrap gap-2"},ce=["min"],me={key:0,class:"text-chili-600"},pe={key:0},ve={class:"col-span-2"},be=["placeholder"],xe={key:0,class:"text-chili-600"},fe=["disabled"],Te=L({__name:"PeopleCreate",setup(g){const u=M(),s=B(),y=Q({immediate:!1}),h=E(),v=J(),e=$({}),b=new Date,a=S({name:"",colony:"",description:"",addLocation:!1,date:I(b),time:C(b),topic:"",returnDate:I(new Date(b.getTime()+1e3*60*60*24*7)),returnTime:C(b),notes:""});async function k(x){if(!Object.values(e.value).some(t=>t))try{await v.mutateAsync({person:{name:a.name,colony:a.colony,description:a.description,location:x?{longitude:x.longitude,latitude:x.latitude,altitude:x.altitude}:void 0},returnVisit:{date:new Date(a.date+"T"+a.time),topic:a.topic,returnDate:new Date(a.returnDate+"T"+a.returnTime),notes:a.notes}}),u.replace("/")}catch(t){console.info(t),alert(`Error guardando los datos
Por favor intenta de nuevo`)}}function U(){if(v.isPending.value)return;a.name||(e.value={...e.value,name:"Falta nombre"}),a.colony||(e.value={...e.value,colony:"Falta colonia"}),a.date||(e.value={...e.value,date:"Falta fecha"}),a.time||(e.value={...e.value,time:"Falta hora"}),a.topic||(e.value={...e.value,topic:"Falta tema"}),a.returnDate||(e.value={...e.value,returnDate:"Falta fecha de revisita"}),a.returnTime||(e.value={...e.value,returnTime:"Falta hora de revisita"});const x=new Date(a.date+"T"+a.time),t=new Date(a.returnDate+"T"+a.returnTime);if(x.getTime()>t.getTime()&&(e.value={...e.value,returnDate:"Fecha de revisita tiene que ser posterior a fecha de visita"}),a.addLocation){y.resume(),N([y.coords,y.error],([l,P])=>{if(P){e.value={...e.value,location:"Error obteniendo la ubicación"};return}k(l)},{once:!0});return}k()}return(x,t)=>(r(),n("main",R,[t[25]||(t[25]=o("h1",{class:"text-3xl font-bold mb-4"},"Agregar persona",-1)),o("form",{class:"grid grid-cols-3 gap-2 gap-y-3",onSubmit:K(U,["prevent"])},[t[17]||(t[17]=o("label",{class:"text-right",for:"name"},"Nombre",-1)),o("div",z,[d(o("input",{id:"name",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 w-full",e.value.name?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"text",name:"name","onUpdate:modelValue":t[0]||(t[0]=l=>a.name=l),placeholder:"Saulo",onInput:t[1]||(t[1]=l=>e.value.name=""),required:""},null,34),[[p,a.name]]),e.value.name?(r(),n("small",G,i(e.value.name),1)):m("",!0)]),t[18]||(t[18]=o("label",{class:"text-right",for:"colony"},"Colonia",-1)),o("div",O,[d(o("input",{id:"colony",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 w-full",e.value.colony?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"text",name:"colony",list:"colonyList","onUpdate:modelValue":t[2]||(t[2]=l=>a.colony=l),placeholder:"Tarso",onInput:t[3]||(t[3]=l=>e.value.colony=""),required:""},null,34),[[p,a.colony]]),e.value.colony?(r(),n("small",H,i(e.value.colony),1)):m("",!0),o("datalist",W,[(r(!0),n(q,null,V(w(s),l=>(r(),n("option",{key:l},i(l),1))),128))])]),t[19]||(t[19]=o("label",{class:"text-right",for:"location"},"Ubicación",-1)),o("div",X,[d(o("input",{type:"checkbox",id:"location",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm",e.value.location?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),name:"location","onUpdate:modelValue":t[4]||(t[4]=l=>a.addLocation=l)},null,2),[[j,a.addLocation]]),e.value.location?(r(),n("small",Y,i(e.value.location),1)):m("",!0)]),t[20]||(t[20]=o("label",{class:"text-right",for:"description"},"Descripción",-1)),o("div",Z,[d(o("textarea",{id:"description",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","resize-y min-h-16 max-h-72 w-full",e.value.description?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),rows:"8",name:"description","onUpdate:modelValue":t[5]||(t[5]=l=>a.description=l),placeholder:[`Calle Recta, casa de Judas.
`,"Israelita de la tribu de Benjamín","Estaba orando, no puede ver."].join(`
`),maxlength:"250"},null,10,ee),[[p,a.description]]),e.value.description?(r(),n("small",te,i(e.value.description),1)):m("",!0)]),t[21]||(t[21]=o("div",{class:"text-right"},[o("label",{for:"date"},"Fecha"),f(" y "),o("label",{for:"time"},"hora")],-1)),o("div",ae,[o("div",oe,[d(o("input",{id:"date",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.date?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"date",name:"date","onUpdate:modelValue":t[6]||(t[6]=l=>a.date=l),onInput:t[7]||(t[7]=l=>e.value.date=""),required:""},null,34),[[p,a.date]]),d(o("input",{id:"time",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.time?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"time",name:"time","onUpdate:modelValue":t[8]||(t[8]=l=>a.time=l),onInput:t[9]||(t[9]=l=>e.value.time=""),required:""},null,34),[[p,a.time]])]),e.value.date||e.value.time?(r(),n("small",le,[f(i(e.value.date)+" ",1),e.value.date&&e.value.time?(r(),n("br",ne)):m("",!0),f(" "+i(e.value.time),1)])):m("",!0)]),t[22]||(t[22]=o("label",{class:"text-right",for:"topic"},"Tema",-1)),o("div",re,[d(o("input",{id:"topic",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 w-full",e.value.topic?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"string",name:"topic","onUpdate:modelValue":t[10]||(t[10]=l=>a.topic=l),onInput:t[11]||(t[11]=l=>e.value.topic=""),list:"topicDataList",placeholder:"Visitar para devolver la vista",required:""},null,34),[[p,a.topic]]),e.value.topic?(r(),n("small",se,i(e.value.topic),1)):m("",!0),o("datalist",ie,[(r(!0),n(q,null,V(w(h),l=>(r(),n("option",{key:l},i(l),1))),128))])]),t[23]||(t[23]=o("div",{class:"text-right"},[o("label",{for:"returnDate"},"Fecha"),f(" y "),o("label",{for:"returnTime"},"hora"),f(" de revisita ")],-1)),o("div",ue,[o("div",de,[d(o("input",{id:"returnDate",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.returnDate?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"date",name:"returnDate","onUpdate:modelValue":t[12]||(t[12]=l=>a.returnDate=l),min:a.date,onChange:t[13]||(t[13]=l=>e.value.returnDate=""),required:""},null,42,ce),[[p,a.returnDate]]),d(o("input",{id:"returnTime",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.returnTime?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"time",name:"returnTime","onUpdate:modelValue":t[14]||(t[14]=l=>a.returnTime=l),onInput:t[15]||(t[15]=l=>e.value.returnTime=""),required:""},null,34),[[p,a.returnTime]])]),e.value.returnDate||e.value.returnTime?(r(),n("small",me,[f(i(e.value.returnDate)+" ",1),e.value.returnDate&&e.value.returnTime?(r(),n("br",pe)):m("",!0),f(" "+i(e.value.returnTime),1)])):m("",!0)]),t[24]||(t[24]=o("label",{class:"text-right",for:"notes"},"Notas",-1)),o("div",ve,[d(o("textarea",{id:"notes",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","resize-y min-h-16 max-h-72 w-full",e.value.notes?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),name:"notes","onUpdate:modelValue":t[16]||(t[16]=l=>a.notes=l),placeholder:[`Jesucristo me envió, no tengo muchas ganas de ir porque este hombre le ha hecho mucho daño a los santos en Jerusalén.
`,"Jesús dice que es un instrumento para llevar su nombre a las naciones."].join(`
`),rows:"10",maxlength:"500"},null,10,be),[[p,a.notes]]),e.value.notes?(r(),n("small",xe,i(e.value.notes),1)):m("",!0)]),o("button",{class:"col-start-3 bg-asparagus-600 rounded px-2 py-1 text-lemon-50",type:"submit",disabled:w(v).isPending.value}," Guardar ",8,fe)],32)]))}});export{Te as default};
