import{u as P,a as D,p as T,r as F,d as $,b as _,c as K,e as n,f as o,w as u,v as m,n as d,t as s,g as c,F as q,h as I,i as k,j as M,k as x,l as N,m as Q,o as r,q as S}from"./index-Ce8Ut3pY.js";import{u as A}from"./index-DiMl7QwM.js";import{u as z}from"./useMutation-CR7Mmd-I.js";import{u as B}from"./useColonies-B5JQZzPI.js";import{u as E}from"./useAvailableTopics-CJCUQSm9.js";import{g as V,a as U}from"./getDateTimeForInput-BOWwtIe8.js";function j(){const b=P();return z({mutationFn:async({person:p,returnVisit:i})=>{const f=await D("people",p),y=i?await D("returnVisits",{...i,personId:f}):void 0;return{person:{id:f,...p},...y?{...i,personId:y[0],date:y[1]}:{}}},onSuccess:({person:p,returnVisit:i})=>{b.invalidateQueries({queryKey:T.all()}),b.setQueryData(T.detail(p.id),p),i&&(b.invalidateQueries({queryKey:F.all()}),b.setQueryData(F.detail(i.personId,i.date),i))}})}const G={class:"max-w-prose mx-auto py-2 px-3"},R={class:"col-span-2"},O={key:0,class:"text-chili-600"},H={class:"col-span-2"},J={key:0,class:"text-chili-600"},W={id:"colonyList"},X={class:"col-span-2 self-center"},Y={key:0,class:"text-chili-600"},Z={class:"col-span-2"},ee={key:0,class:"text-chili-600"},te={class:"col-span-2"},ae={class:"flex flex-wrap gap-2"},oe={key:0,class:"text-chili-600"},le={key:0},ne={class:"col-span-2"},re={key:0,class:"text-chili-600"},se={id:"topicDataList"},ie={class:"col-span-2"},ue={class:"flex flex-wrap gap-2"},de=["min"],ce={key:0,class:"text-chili-600"},me={key:0},pe={class:"col-span-2"},ve={key:0,class:"text-chili-600"},xe=["disabled"],we=$({__name:"PeopleCreate",setup(b){const p=Q(),i=B(),f=A({immediate:!1}),y=E(),h=j(),e=_({}),g=new Date,a=K({name:"",colony:"",description:"",addLocation:!1,date:V(g),time:U(g),topic:"",returnDate:V(new Date(g.getTime()+1e3*60*60*24*7)),returnTime:U(g),notes:""});async function w(v){if(!Object.values(e.value).some(t=>t))try{await h.mutateAsync({person:{name:a.name,colony:a.colony,description:a.description,location:v?{longitude:v.longitude,latitude:v.latitude,altitude:v.altitude}:void 0},returnVisit:{date:new Date(a.date+"T"+a.time),topic:a.topic,returnDate:new Date(a.returnDate+"T"+a.returnTime),notes:a.notes}}),p.replace("/")}catch(t){console.info(t),alert(`Error guardando los datos
Por favor intenta de nuevo`)}}function C(){if(h.isPending.value)return;a.name||(e.value={...e.value,name:"Falta nombre"}),a.colony||(e.value={...e.value,colony:"Falta colonia"}),a.date||(e.value={...e.value,date:"Falta fecha"}),a.time||(e.value={...e.value,time:"Falta hora"}),a.topic||(e.value={...e.value,topic:"Falta tema"}),a.returnDate||(e.value={...e.value,returnDate:"Falta fecha de revisita"}),a.returnTime||(e.value={...e.value,returnTime:"Falta hora de revisita"});const v=new Date(a.date+"T"+a.time),t=new Date(a.returnDate+"T"+a.returnTime);if(v.getTime()>t.getTime()&&(e.value={...e.value,returnDate:"Fecha de revisita tiene que ser posterior a fecha de visita"}),a.addLocation){f.resume(),S([f.coords,f.error],([l,L])=>{if(L){e.value={...e.value,location:"Error obteniendo la ubicación"};return}w(l)},{once:!0});return}w()}return(v,t)=>(r(),n("main",G,[t[25]||(t[25]=o("h1",{class:"text-3xl font-bold mb-4"},"Agregar persona",-1)),o("form",{class:"grid grid-cols-3 gap-2 gap-y-3",onSubmit:N(C,["prevent"])},[t[17]||(t[17]=o("label",{class:"text-right",for:"name"},"Nombre",-1)),o("div",R,[u(o("input",{id:"name",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 w-full",e.value.name?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"text",name:"name","onUpdate:modelValue":t[0]||(t[0]=l=>a.name=l),onInput:t[1]||(t[1]=l=>e.value.name=""),required:""},null,34),[[m,a.name]]),e.value.name?(r(),n("small",O,s(e.value.name),1)):c("",!0)]),t[18]||(t[18]=o("label",{class:"text-right",for:"colony"},"Colonia",-1)),o("div",H,[u(o("input",{id:"colony",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 w-full",e.value.colony?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"text",name:"colony",list:"colonyList","onUpdate:modelValue":t[2]||(t[2]=l=>a.colony=l),onInput:t[3]||(t[3]=l=>e.value.colony=""),required:""},null,34),[[m,a.colony]]),e.value.colony?(r(),n("small",J,s(e.value.colony),1)):c("",!0),o("datalist",W,[(r(!0),n(q,null,I(k(i),l=>(r(),n("option",{key:l},s(l),1))),128))])]),t[19]||(t[19]=o("label",{class:"text-right",for:"location"},"Ubicación",-1)),o("div",X,[u(o("input",{type:"checkbox",id:"location",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm",e.value.location?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),name:"location","onUpdate:modelValue":t[4]||(t[4]=l=>a.addLocation=l)},null,2),[[M,a.addLocation]]),e.value.location?(r(),n("small",Y,s(e.value.location),1)):c("",!0)]),t[20]||(t[20]=o("label",{class:"text-right",for:"description"},"Descripción",-1)),o("div",Z,[u(o("textarea",{id:"description",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","resize-y min-h-16 max-h-72 w-full",e.value.description?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),rows:"8",name:"description","onUpdate:modelValue":t[5]||(t[5]=l=>a.description=l),maxlength:"250"},null,2),[[m,a.description]]),e.value.description?(r(),n("small",ee,s(e.value.description),1)):c("",!0)]),t[21]||(t[21]=o("div",{class:"text-right"},[o("label",{for:"date"},"Fecha"),x(" y "),o("label",{for:"time"},"hora")],-1)),o("div",te,[o("div",ae,[u(o("input",{id:"date",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.date?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"date",name:"date","onUpdate:modelValue":t[6]||(t[6]=l=>a.date=l),onInput:t[7]||(t[7]=l=>e.value.date=""),required:""},null,34),[[m,a.date]]),u(o("input",{id:"time",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.time?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"time",name:"time","onUpdate:modelValue":t[8]||(t[8]=l=>a.time=l),onInput:t[9]||(t[9]=l=>e.value.time=""),required:""},null,34),[[m,a.time]])]),e.value.date||e.value.time?(r(),n("small",oe,[x(s(e.value.date)+" ",1),e.value.date&&e.value.time?(r(),n("br",le)):c("",!0),x(" "+s(e.value.time),1)])):c("",!0)]),t[22]||(t[22]=o("label",{class:"text-right",for:"topic"},"Tema",-1)),o("div",ne,[u(o("input",{id:"topic",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 w-full",e.value.topic?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"string",name:"topic","onUpdate:modelValue":t[10]||(t[10]=l=>a.topic=l),onInput:t[11]||(t[11]=l=>e.value.topic=""),list:"topicDataList",required:""},null,34),[[m,a.topic]]),e.value.topic?(r(),n("small",re,s(e.value.topic),1)):c("",!0),o("datalist",se,[(r(!0),n(q,null,I(k(y),l=>(r(),n("option",{key:l},s(l),1))),128))])]),t[23]||(t[23]=o("div",{class:"text-right"},[o("label",{for:"returnDate"},"Fecha"),x(" y "),o("label",{for:"returnTime"},"hora"),x(" de revisita ")],-1)),o("div",ie,[o("div",ue,[u(o("input",{id:"returnDate",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.returnDate?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"date",name:"returnDate","onUpdate:modelValue":t[12]||(t[12]=l=>a.returnDate=l),min:a.date,onChange:t[13]||(t[13]=l=>e.value.returnDate=""),required:""},null,42,de),[[m,a.returnDate]]),u(o("input",{id:"returnTime",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.returnTime?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"time",name:"returnTime","onUpdate:modelValue":t[14]||(t[14]=l=>a.returnTime=l),onInput:t[15]||(t[15]=l=>e.value.returnTime=""),required:""},null,34),[[m,a.returnTime]])]),e.value.returnDate||e.value.returnTime?(r(),n("small",ce,[x(s(e.value.returnDate)+" ",1),e.value.returnDate&&e.value.returnTime?(r(),n("br",me)):c("",!0),x(" "+s(e.value.returnTime),1)])):c("",!0)]),t[24]||(t[24]=o("label",{class:"text-right",for:"notes"},"Notas",-1)),o("div",pe,[u(o("textarea",{id:"notes",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","resize-y min-h-16 max-h-72 w-full",e.value.notes?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),rows:"8",name:"notes","onUpdate:modelValue":t[16]||(t[16]=l=>a.notes=l),maxlength:"250"},null,2),[[m,a.notes]]),e.value.notes?(r(),n("small",ve,s(e.value.notes),1)):c("",!0)]),o("button",{class:"col-start-3 bg-asparagus-600 rounded px-2 py-1 text-lemon-50",type:"submit",disabled:k(h).isPending.value}," Guardar ",8,xe)],32)]))}});export{we as default};
