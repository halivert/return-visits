import{C as H,r as w,E as J,u as K,x as D,i as u,G as N,a as W,H as X,d as Y,I as Z,b as V,c as ee,q as ae,e as s,F as I,k as m,t as v,l as te,f as l,w as g,J as oe,n as h,h as B,g as f,v as k,y as le,z as re,m as se,B as ne,o as n}from"./index-Ce8Ut3pY.js";import{g as F,a as S}from"./getDateTimeForInput-BOWwtIe8.js";import{u as ue}from"./useAvailableTopics-CJCUQSm9.js";import{u as $}from"./useMutation-CR7Mmd-I.js";function M({personId:i,date:d}){return H({queryKey:w.detail(i,d),queryFn:({queryKey:c})=>J("returnVisits",[c[2],c[3]])})}function ie({personId:i,date:d}){const c=K(),{data:x}=M({personId:i,date:d});return $({mutationFn:D(()=>async p=>{if(!x.value)return Promise.reject(new Error("Revisita no encontrada"));const b={...x.value,...p};return u(i)!==b.personId||u(d).toISOString()!==b.date.toISOString()?(await N("returnVisits",[u(i),u(d)]),await W("returnVisits",b)):await X("returnVisits",[u(i),u(d)],b),b}),onSuccess:p=>{c.invalidateQueries({queryKey:w.list(p.personId)}),c.setQueryData(w.detail(p.personId,p.date),p),p.personId!==u(i)&&c.invalidateQueries({queryKey:w.list(i)}),(p.personId!==u(i)||p.date!==u(d))&&c.invalidateQueries({queryKey:w.detail(i,d)})}})}function de({personId:i,date:d}){const c=K();return $({mutationFn:D(()=>async()=>{await N("returnVisits",[u(i),u(d)])}),onSuccess:()=>{c.invalidateQueries({queryKey:w.all()})}})}const pe={class:"col-span-2"},ce=["value"],me={key:0,class:"text-chili-600"},ve={class:"col-span-2"},ye={class:"flex flex-wrap gap-2"},fe={key:0,class:"text-chili-600"},xe={key:0},be={class:"col-span-2"},ge={key:0,class:"text-chili-600"},he={id:"topicDataList"},ke={class:"col-span-2"},we={class:"flex flex-wrap gap-2"},De=["min"],Ie={key:0,class:"text-chili-600"},Te={key:0},Fe={class:"col-span-2"},Se={key:0,class:"text-chili-600"},Ue=Y({__name:"ReturnVisitsEdit",props:{id:{},date:{}},setup(i){var C,R,Q,U,E,L,P;const d=se(),c=i,x=D(()=>c.id),p=D(()=>c.date),b=ie({personId:x,date:p}),_=de({personId:x,date:p}),T=M({personId:x,date:p}),y=D(()=>T.data.value),z=ue(),A=Z(),q=D(()=>A.data.value??[]),e=V({}),t=ee({personId:(C=y.value)==null?void 0:C.personId,topic:(R=y.value)==null?void 0:R.topic,date:F((Q=y.value)==null?void 0:Q.date),time:S((U=y.value)==null?void 0:U.date),returnDate:F((E=y.value)==null?void 0:E.returnDate),returnTime:S((L=y.value)==null?void 0:L.returnDate),notes:(P=y.value)==null?void 0:P.notes});ae(y,o=>{t.personId=o==null?void 0:o.personId,t.topic=o==null?void 0:o.topic,t.date=F(o==null?void 0:o.date),t.time=S(o==null?void 0:o.date),t.returnDate=F(o==null?void 0:o.returnDate),t.returnTime=S(o==null?void 0:o.returnDate),t.notes=o==null?void 0:o.notes});async function O(){try{await _.mutateAsync(),d.back()}catch(o){console.info(o)}}async function j(){if(t.personId||(e.value={...e.value,personId:"Elige a la persona"}),t.topic||(e.value={...e.value,topic:"Falta tema"}),t.date||(e.value={...e.value,date:"Falta fecha"}),t.time||(e.value={...e.value,time:"Falta hora"}),t.returnDate||(e.value={...e.value,returnDate:"Falta fecha de revisita"}),t.returnTime||(e.value={...e.value,returnTime:"Falta hora de revisita"}),!Object.values(e.value).some(Boolean))try{await b.mutateAsync({personId:t.personId,date:new Date(t.date+"T"+t.time),topic:t.topic,returnDate:new Date(t.returnDate+"T"+t.returnTime),notes:t.notes}),d.replace({name:"PeopleShow",params:{id:x.value}})}catch(o){console.info(o)}}return(o,a)=>{const G=ne("RouterLink");return n(),s("div",null,[u(T).isLoading.value?(n(),s(I,{key:0},[m("Cargando...")],64)):u(T).error.value||!y.value?(n(),s(I,{key:1},[m(v(u(T).error.value||"Error"),1)],64)):(n(),s("form",{key:2,class:"grid grid-cols-3 gap-2 gap-y-3",onSubmit:te(j,["prevent"])},[q.value.length>1?(n(),s(I,{key:0},[a[12]||(a[12]=l("label",{class:"text-right",for:"personId"},"Persona",-1)),l("div",pe,[g(l("select",{id:"personId",class:h(["w-full h-8 px-2 py-1 border dark:text-lemon-50",e.value.personId?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),"onUpdate:modelValue":a[0]||(a[0]=r=>t.personId=r)},[(n(!0),s(I,null,B(q.value,r=>(n(),s("option",{key:r.id,value:r.id},v(r.name),9,ce))),128))],2),[[oe,t.personId]]),e.value.personId?(n(),s("small",me,v(e.value.personId),1)):f("",!0)])],64)):f("",!0),a[14]||(a[14]=l("div",{class:"text-right"},[l("label",{for:"date"},"Fecha"),m(" y "),l("label",{for:"time"},"hora")],-1)),l("div",ve,[l("div",ye,[g(l("input",{id:"date",class:h(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.date?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"date",name:"date","onUpdate:modelValue":a[1]||(a[1]=r=>t.date=r),onInput:a[2]||(a[2]=r=>e.value.date=""),required:""},null,34),[[k,t.date]]),g(l("input",{id:"time",class:h(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.time?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"time",name:"time","onUpdate:modelValue":a[3]||(a[3]=r=>t.time=r),onInput:a[4]||(a[4]=r=>e.value.time=""),required:""},null,34),[[k,t.time]])]),e.value.date||e.value.time?(n(),s("small",fe,[m(v(e.value.date)+" ",1),e.value.date&&e.value.time?(n(),s("br",xe)):f("",!0),m(" "+v(e.value.time),1)])):f("",!0)]),a[15]||(a[15]=l("label",{class:"text-right",for:"topic"},"Tema",-1)),l("div",be,[g(l("input",{id:"topic",class:h(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 w-full",e.value.topic?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"string",name:"topic","onUpdate:modelValue":a[5]||(a[5]=r=>t.topic=r),onInput:a[6]||(a[6]=r=>e.value.topic=""),list:"topicDataList",required:""},null,34),[[k,t.topic]]),e.value.topic?(n(),s("small",ge,v(e.value.topic),1)):f("",!0),l("datalist",he,[(n(!0),s(I,null,B(u(z),r=>(n(),s("option",{key:r},v(r),1))),128))])]),a[16]||(a[16]=l("div",{class:"text-right"},[l("label",{for:"returnDate"},"Fecha"),m(" y "),l("label",{for:"returnTime"},"hora"),m(" de revisita ")],-1)),l("div",ke,[l("div",we,[g(l("input",{id:"returnDate",class:h(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.returnDate?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"date",name:"returnDate","onUpdate:modelValue":a[7]||(a[7]=r=>t.returnDate=r),min:t.date,onChange:a[8]||(a[8]=r=>e.value.returnDate=""),required:""},null,42,De),[[k,t.returnDate]]),g(l("input",{id:"returnTime",class:h(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.returnTime?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"time",name:"returnTime","onUpdate:modelValue":a[9]||(a[9]=r=>t.returnTime=r),onInput:a[10]||(a[10]=r=>e.value.returnTime=""),required:""},null,34),[[k,t.returnTime]])]),e.value.returnDate||e.value.returnTime?(n(),s("small",Ie,[m(v(e.value.returnDate)+" ",1),e.value.returnDate&&e.value.returnTime?(n(),s("br",Te)):f("",!0),m(" "+v(e.value.returnTime),1)])):f("",!0)]),a[17]||(a[17]=l("label",{class:"text-right",for:"notes"},"Notas",-1)),l("div",Fe,[g(l("textarea",{id:"notes",class:h(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","resize-y min-h-16 max-h-72 w-full",e.value.notes?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),rows:"8","onUpdate:modelValue":a[11]||(a[11]=r=>t.notes=r),name:"notes",maxlength:"250"},null,2),[[k,t.notes]]),e.value.notes?(n(),s("small",Se,v(e.value.notes),1)):f("",!0)]),le(G,{class:"col-start-2 border underline border-asparagus-600 rounded px-2 py-1 text-asparagus-600 text-center",to:{name:"PeopleShow",params:{id:o.id}}},{default:re(()=>a[13]||(a[13]=[m(" Cancelar ")])),_:1},8,["to"]),a[18]||(a[18]=l("button",{class:"bg-asparagus-600 rounded px-2 py-1 text-lemon-50",type:"submit"}," Guardar ",-1)),l("button",{class:"col-start-2 bg-fawn-600 rounded px-2 py-1 text-fawn-50 text-center",onClick:O,type:"button"}," Eliminar ")],32))])}}});export{Ue as default};
