import{u as L,a as D,p as T,r as F,d as $,b as _,c as K,e as n,f as o,w as d,v as p,n as c,t as s,g as m,F as q,h as V,i as w,j as M,k as b,l as N,m as Q,o as i,q as S}from"./index-BzlAtdqQ.js";import{u as A}from"./index-2urXqW4y.js";import{u as z}from"./useMutation-Ca4hD85O.js";import{u as B}from"./useColonies-BhmOh_xi.js";import{u as E}from"./useAvailableTopics-CSAzX7J1.js";import{g as I,a as U}from"./getDateTimeForInput-BOWwtIe8.js";function R(){const g=L();return z({mutationFn:async({person:u,returnVisit:r})=>{var x;const y={colony:u.colony.trim(),name:u.name.trim(),description:u.description.trim(),location:u.location},h=await D("people",y),v=r&&h!=null?{personId:h,date:r.date,topic:r.topic.trim(),returnDate:r.returnDate,notes:(x=r.notes)==null?void 0:x.trim()}:void 0,e=v?await D("returnVisits",v):void 0;return{person:{id:h,...y},returnVisit:e&&v?v:void 0}},onSuccess:({person:u,returnVisit:r})=>{g.invalidateQueries({queryKey:T.all()}),g.setQueryData(T.detail(u.id),u),r&&(g.invalidateQueries({queryKey:F.list(u.id)}),g.setQueryData(F.detail(r.personId,r.date),r))}})}const j={class:"max-w-prose mx-auto py-2 px-3"},G={class:"col-span-2"},O={key:0,class:"text-chili-600"},H={class:"col-span-2"},J={key:0,class:"text-chili-600"},W={id:"colonyList"},X={class:"col-span-2 self-center"},Y={key:0,class:"text-chili-600"},Z={class:"col-span-2"},ee={key:0,class:"text-chili-600"},te={class:"col-span-2"},ae={class:"flex flex-wrap gap-2"},oe={key:0,class:"text-chili-600"},le={key:0},ne={class:"col-span-2"},ie={key:0,class:"text-chili-600"},re={id:"topicDataList"},se={class:"col-span-2"},ue={class:"flex flex-wrap gap-2"},de=["min"],ce={key:0,class:"text-chili-600"},me={key:0},pe={class:"col-span-2"},ve={key:0,class:"text-chili-600"},xe=["disabled"],ke=$({__name:"PeopleCreate",setup(g){const u=Q(),r=B(),y=A({immediate:!1}),h=E(),v=R(),e=_({}),x=new Date,a=K({name:"",colony:"",description:"",addLocation:!1,date:I(x),time:U(x),topic:"",returnDate:I(new Date(x.getTime()+1e3*60*60*24*7)),returnTime:U(x),notes:""});async function k(f){if(!Object.values(e.value).some(t=>t))try{await v.mutateAsync({person:{name:a.name,colony:a.colony,description:a.description,location:f?{longitude:f.longitude,latitude:f.latitude,altitude:f.altitude}:void 0},returnVisit:{date:new Date(a.date+"T"+a.time),topic:a.topic,returnDate:new Date(a.returnDate+"T"+a.returnTime),notes:a.notes}}),u.replace("/")}catch(t){console.info(t),alert(`Error guardando los datos
Por favor intenta de nuevo`)}}function C(){if(v.isPending.value)return;a.name||(e.value={...e.value,name:"Falta nombre"}),a.colony||(e.value={...e.value,colony:"Falta colonia"}),a.date||(e.value={...e.value,date:"Falta fecha"}),a.time||(e.value={...e.value,time:"Falta hora"}),a.topic||(e.value={...e.value,topic:"Falta tema"}),a.returnDate||(e.value={...e.value,returnDate:"Falta fecha de revisita"}),a.returnTime||(e.value={...e.value,returnTime:"Falta hora de revisita"});const f=new Date(a.date+"T"+a.time),t=new Date(a.returnDate+"T"+a.returnTime);if(f.getTime()>t.getTime()&&(e.value={...e.value,returnDate:"Fecha de revisita tiene que ser posterior a fecha de visita"}),a.addLocation){y.resume(),S([y.coords,y.error],([l,P])=>{if(P){e.value={...e.value,location:"Error obteniendo la ubicación"};return}k(l)},{once:!0});return}k()}return(f,t)=>(i(),n("main",j,[t[25]||(t[25]=o("h1",{class:"text-3xl font-bold mb-4"},"Agregar persona",-1)),o("form",{class:"grid grid-cols-3 gap-2 gap-y-3",onSubmit:N(C,["prevent"])},[t[17]||(t[17]=o("label",{class:"text-right",for:"name"},"Nombre",-1)),o("div",G,[d(o("input",{id:"name",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 w-full",e.value.name?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"text",name:"name","onUpdate:modelValue":t[0]||(t[0]=l=>a.name=l),onInput:t[1]||(t[1]=l=>e.value.name=""),required:""},null,34),[[p,a.name]]),e.value.name?(i(),n("small",O,s(e.value.name),1)):m("",!0)]),t[18]||(t[18]=o("label",{class:"text-right",for:"colony"},"Colonia",-1)),o("div",H,[d(o("input",{id:"colony",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 w-full",e.value.colony?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"text",name:"colony",list:"colonyList","onUpdate:modelValue":t[2]||(t[2]=l=>a.colony=l),onInput:t[3]||(t[3]=l=>e.value.colony=""),required:""},null,34),[[p,a.colony]]),e.value.colony?(i(),n("small",J,s(e.value.colony),1)):m("",!0),o("datalist",W,[(i(!0),n(q,null,V(w(r),l=>(i(),n("option",{key:l},s(l),1))),128))])]),t[19]||(t[19]=o("label",{class:"text-right",for:"location"},"Ubicación",-1)),o("div",X,[d(o("input",{type:"checkbox",id:"location",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm",e.value.location?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),name:"location","onUpdate:modelValue":t[4]||(t[4]=l=>a.addLocation=l)},null,2),[[M,a.addLocation]]),e.value.location?(i(),n("small",Y,s(e.value.location),1)):m("",!0)]),t[20]||(t[20]=o("label",{class:"text-right",for:"description"},"Descripción",-1)),o("div",Z,[d(o("textarea",{id:"description",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","resize-y min-h-16 max-h-72 w-full",e.value.description?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),rows:"8",name:"description","onUpdate:modelValue":t[5]||(t[5]=l=>a.description=l),maxlength:"250"},null,2),[[p,a.description]]),e.value.description?(i(),n("small",ee,s(e.value.description),1)):m("",!0)]),t[21]||(t[21]=o("div",{class:"text-right"},[o("label",{for:"date"},"Fecha"),b(" y "),o("label",{for:"time"},"hora")],-1)),o("div",te,[o("div",ae,[d(o("input",{id:"date",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.date?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"date",name:"date","onUpdate:modelValue":t[6]||(t[6]=l=>a.date=l),onInput:t[7]||(t[7]=l=>e.value.date=""),required:""},null,34),[[p,a.date]]),d(o("input",{id:"time",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.time?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"time",name:"time","onUpdate:modelValue":t[8]||(t[8]=l=>a.time=l),onInput:t[9]||(t[9]=l=>e.value.time=""),required:""},null,34),[[p,a.time]])]),e.value.date||e.value.time?(i(),n("small",oe,[b(s(e.value.date)+" ",1),e.value.date&&e.value.time?(i(),n("br",le)):m("",!0),b(" "+s(e.value.time),1)])):m("",!0)]),t[22]||(t[22]=o("label",{class:"text-right",for:"topic"},"Tema",-1)),o("div",ne,[d(o("input",{id:"topic",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 w-full",e.value.topic?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"string",name:"topic","onUpdate:modelValue":t[10]||(t[10]=l=>a.topic=l),onInput:t[11]||(t[11]=l=>e.value.topic=""),list:"topicDataList",required:""},null,34),[[p,a.topic]]),e.value.topic?(i(),n("small",ie,s(e.value.topic),1)):m("",!0),o("datalist",re,[(i(!0),n(q,null,V(w(h),l=>(i(),n("option",{key:l},s(l),1))),128))])]),t[23]||(t[23]=o("div",{class:"text-right"},[o("label",{for:"returnDate"},"Fecha"),b(" y "),o("label",{for:"returnTime"},"hora"),b(" de revisita ")],-1)),o("div",se,[o("div",ue,[d(o("input",{id:"returnDate",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.returnDate?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"date",name:"returnDate","onUpdate:modelValue":t[12]||(t[12]=l=>a.returnDate=l),min:a.date,onChange:t[13]||(t[13]=l=>e.value.returnDate=""),required:""},null,42,de),[[p,a.returnDate]]),d(o("input",{id:"returnTime",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.returnTime?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"time",name:"returnTime","onUpdate:modelValue":t[14]||(t[14]=l=>a.returnTime=l),onInput:t[15]||(t[15]=l=>e.value.returnTime=""),required:""},null,34),[[p,a.returnTime]])]),e.value.returnDate||e.value.returnTime?(i(),n("small",ce,[b(s(e.value.returnDate)+" ",1),e.value.returnDate&&e.value.returnTime?(i(),n("br",me)):m("",!0),b(" "+s(e.value.returnTime),1)])):m("",!0)]),t[24]||(t[24]=o("label",{class:"text-right",for:"notes"},"Notas",-1)),o("div",pe,[d(o("textarea",{id:"notes",class:c(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","resize-y min-h-16 max-h-72 w-full",e.value.notes?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),name:"notes","onUpdate:modelValue":t[16]||(t[16]=l=>a.notes=l),rows:"10",maxlength:"500"},null,2),[[p,a.notes]]),e.value.notes?(i(),n("small",ve,s(e.value.notes),1)):m("",!0)]),o("button",{class:"col-start-3 bg-asparagus-600 rounded px-2 py-1 text-lemon-50",type:"submit",disabled:w(v).isPending.value}," Guardar ",8,xe)],32)]))}});export{ke as default};
