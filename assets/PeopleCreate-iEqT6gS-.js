import{u as q,a as g,p as b,r as V,d as P,c as C,b as a,e as n,f as o,g as v,_ as x,w as I,h as B,o as K,i as N}from"./index-D6IdYIOx.js";import{u as Q}from"./index-B7Cq8lQG.js";import{u as S}from"./useMutation-BFuSot1U.js";import{u as j}from"./useColonies-CfLNqg5y.js";import{u as k,g as D,a as T}from"./getDateTimeForInput-CEVL2o50.js";import{u as A,_ as d,a as w}from"./VTextarea.vue_vue_type_script_setup_true_lang-TlYwyJ6E.js";import"./useReturnVisits-BBX5RBm0.js";function E(){const f=q();return S({mutationFn:async({person:i,returnVisit:s})=>{var e;const m={colony:i.colony.trim(),name:i.name.trim(),description:i.description.trim(),location:i.location},c=await g("people",m),l=s&&c!=null?{personId:c,date:s.date,topic:s.topic.trim(),returnDate:s.returnDate,notes:(e=s.notes)==null?void 0:e.trim()}:void 0,p=l?await g("returnVisits",l):void 0;return{person:{id:c,...m},returnVisit:p&&l?l:void 0}},onSuccess:({person:i,returnVisit:s})=>{f.invalidateQueries({queryKey:b.all()}),f.setQueryData(b.detail(i.id),i),s&&(f.invalidateQueries({queryKey:V.list(i.id)}),f.setQueryData(V.detail(s.personId,s.date),s))}})}const J={class:"max-w-prose mx-auto py-2 px-3"},L={class:"col-span-2"},R={class:"flex flex-wrap gap-2"},M={class:"col-span-2"},$={class:"flex flex-wrap gap-2"},z=["disabled"],h=P({__name:"PeopleCreate",setup(f){const i=B(),s=j(),m=Q({immediate:!1}),c=k(),l=E(),p=new Date,e=A({name:"",colony:"",description:"",addLocation:!1,location:void 0,date:D(p),time:T(p),topic:"",returnDate:D(new Date(p.getTime()+1e3*60*60*24*7)),returnTime:T(p),notes:""});async function y(u){if(!l.isPending.value&&!Object.values(e.errors).some(Boolean))try{await l.mutateAsync({person:{name:e.name,colony:e.colony,description:e.description,location:u?{longitude:u.longitude,latitude:u.latitude,altitude:u.altitude}:void 0},returnVisit:{date:new Date(e.date+"T"+e.time),topic:e.topic,returnDate:new Date(e.returnDate+"T"+e.returnTime),notes:e.notes}}),i.back()}catch(r){console.info(r),alert(`Error guardando los datos
Por favor intenta de nuevo`)}}function U(){if(l.isPending.value)return;e.name||(e.errors.name="Falta nombre"),e.colony||(e.errors.colony="Falta colonia"),e.date||(e.errors.date="Falta fecha"),e.time||(e.errors.time="Falta hora"),e.topic||(e.errors.topic="Falta tema"),e.returnDate||(e.errors.returnDate="Falta fecha de revisita"),e.returnTime||(e.errors.returnTime="Falta hora de revisita");const u=new Date(e.date+"T"+e.time),r=new Date(e.returnDate+"T"+e.returnTime);if(u.getTime()>r.getTime()&&(e.errors.returnDate="Fecha de revisita tiene que ser posterior a fecha de visita"),e.addLocation){m.resume(),N([m.coords,m.error],([t,F])=>{if(F){e.errors.location="Error obteniendo la ubicación";return}y(t)},{once:!0});return}y()}return(u,r)=>(K(),C("main",J,[r[28]||(r[28]=a("h1",{class:"text-3xl font-bold mb-4"},"Agregar persona",-1)),a("form",{class:"grid grid-cols-3 gap-2 gap-y-3",onSubmit:I(U,["prevent"])},[r[20]||(r[20]=a("label",{class:"text-right",for:"name"},"Nombre",-1)),n(d,{id:"name","div-class":"col-span-2",modelValue:o(e).name,"onUpdate:modelValue":r[0]||(r[0]=t=>o(e).name=t),errors:o(e).errors.name,"onUpdate:errors":r[1]||(r[1]=t=>o(e).errors.name=t),placeholder:"Saulo",required:""},null,8,["modelValue","errors"]),r[21]||(r[21]=a("label",{class:"text-right",for:"colony"},"Colonia",-1)),n(d,{id:"colony","div-class":"col-span-2",modelValue:o(e).colony,"onUpdate:modelValue":r[2]||(r[2]=t=>o(e).colony=t),errors:o(e).errors.colony,"onUpdate:errors":r[3]||(r[3]=t=>o(e).errors.colony=t),list:o(s),placeholder:"Tarso",required:""},null,8,["modelValue","errors","list"]),r[22]||(r[22]=a("label",{class:"text-right",for:"location"},"Ubicación",-1)),n(d,{id:"location","div-class":"col-span-2 self-center",type:"checkbox",modelValue:o(e).addLocation,"onUpdate:modelValue":r[4]||(r[4]=t=>o(e).addLocation=t),errors:o(e).errors.location,"onUpdate:errors":r[5]||(r[5]=t=>o(e).errors.location=t)},null,8,["modelValue","errors"]),r[23]||(r[23]=a("label",{class:"text-right",for:"description"},"Descripción",-1)),n(w,{id:"description","div-class":"col-span-2",class:"resize-y min-h-16 max-h-72",modelValue:o(e).description,"onUpdate:modelValue":r[6]||(r[6]=t=>o(e).description=t),errors:o(e).errors.description,"onUpdate:errors":r[7]||(r[7]=t=>o(e).errors.description=t),placeholder:[`Calle Recta, casa de Judas.
`,"Israelita de la tribu de Benjamín","Estaba orando, no puede ver."].join(`
`),rows:"8",maxlength:"250"},null,8,["modelValue","errors","placeholder"]),r[24]||(r[24]=a("div",{class:"text-right"},[a("label",{for:"date"},"Fecha"),v(" y "),a("label",{for:"time"},"hora")],-1)),a("div",L,[a("div",R,[n(d,{id:"date","div-class":"flex-1",type:"date",modelValue:o(e).date,"onUpdate:modelValue":r[8]||(r[8]=t=>o(e).date=t),errors:o(e).errors.date,"onUpdate:errors":r[9]||(r[9]=t=>o(e).errors.date=t),"hide-errors":"",required:""},null,8,["modelValue","errors"]),n(d,{id:"time","div-class":"flex-1",type:"time",modelValue:o(e).time,"onUpdate:modelValue":r[10]||(r[10]=t=>o(e).time=t),errors:o(e).errors.time,"onUpdate:errors":r[11]||(r[11]=t=>o(e).errors.time=t),"hide-errors":"",required:""},null,8,["modelValue","errors"])]),n(x,{errors:[o(e).errors.date,o(e).errors.time]},null,8,["errors"])]),r[25]||(r[25]=a("label",{class:"text-right",for:"topic"},"Tema",-1)),n(d,{id:"topic","div-class":"col-span-2",name:"topic",modelValue:o(e).topic,"onUpdate:modelValue":r[12]||(r[12]=t=>o(e).topic=t),errors:o(e).errors.topic,"onUpdate:errors":r[13]||(r[13]=t=>o(e).errors.topic=t),list:o(c),placeholder:"Visitar para devolver la vista",required:""},null,8,["modelValue","errors","list"]),r[26]||(r[26]=a("div",{class:"text-right"},[a("label",{for:"returnDate"},"Fecha"),v(" y "),a("label",{for:"returnTime"},"hora"),v(" de revisita ")],-1)),a("div",M,[a("div",$,[n(d,{id:"returnDate","div-class":"flex-1",type:"date",modelValue:o(e).returnDate,"onUpdate:modelValue":r[14]||(r[14]=t=>o(e).returnDate=t),errors:o(e).errors.returnDate,"onUpdate:errors":r[15]||(r[15]=t=>o(e).errors.returnDate=t),min:o(e).date,"hide-errors":"",required:""},null,8,["modelValue","errors","min"]),n(d,{id:"returnTime","div-class":"flex-1",type:"time",modelValue:o(e).returnTime,"onUpdate:modelValue":r[16]||(r[16]=t=>o(e).returnTime=t),errors:o(e).errors.returnTime,"onUpdate:errors":r[17]||(r[17]=t=>o(e).errors.returnTime=t),"hide-errors":"",required:""},null,8,["modelValue","errors"])]),n(x,{errors:[o(e).errors.returnDate,o(e).errors.returnTime]},null,8,["errors"])]),r[27]||(r[27]=a("label",{class:"text-right",for:"notes"},"Notas",-1)),n(w,{id:"notes","div-class":"col-span-2",class:"resize-y min-h-16 max-h-72",modelValue:o(e).notes,"onUpdate:modelValue":r[18]||(r[18]=t=>o(e).notes=t),errors:o(e).errors.notes,"onUpdate:errors":r[19]||(r[19]=t=>o(e).errors.notes=t),placeholder:[`Jesucristo me envió, no tengo muchas ganas de ir porque este hombre le ha hecho mucho daño a los santos en Jerusalén.
`,"Jesús dice que es un instrumento para llevar su nombre a las naciones."].join(`
`)},null,8,["modelValue","errors","placeholder"]),a("button",{class:"col-start-3 bg-asparagus-600 rounded px-2 py-1 text-lemon-50",type:"submit",disabled:o(l).isPending.value}," Guardar ",8,z)],32)]))}});export{h as default};
