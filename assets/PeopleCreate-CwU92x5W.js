import{u as w,a as k,p as f,d as _,r as P,c as s,b as a,n as u,t as r,e as d,F as C,f as F,g as b,w as S,h as q,o as l,i as D}from"./index-DMjtAVTl.js";import{u as E}from"./index-Kia6NWE0.js";import{u as I}from"./useMutation-DPviKlMa.js";import{u as A}from"./useColonies-BdvGVhfc.js";function B(){const m=w();return I({mutationFn:async n=>({id:await k("people",n),...n}),onSuccess:n=>{m.invalidateQueries({queryKey:f.all()}),m.setQueryData(f.detail(n.id),n)}})}const L={class:"max-w-prose mx-auto py-2 px-3"},M={class:"col-span-2"},N={key:0,class:"text-chili-600"},Q={class:"col-span-2"},j={key:0,class:"text-chili-600"},z={id:"colonyList"},G={class:"col-span-2 self-center"},K={key:0,class:"text-chili-600"},O={class:"col-span-2"},V={key:0,class:"text-chili-600"},$=["disabled"],J=_({__name:"PeopleCreate",setup(m){const n=q(),c=B(),v=A(),p=E({immediate:!1}),e=P({});async function y(i,t){if(!Object.values(e.value).some(o=>o))try{await c.mutateAsync({colony:i.colony,description:i.description,name:i.name,location:t?{longitude:t.longitude,latitude:t.latitude,altitude:t.altitude}:void 0}),n.replace("/")}catch(o){console.info(o),alert(`Error guardando los datos
Por favor intenta de nuevo`)}}function x(i){if(c.isPending.value)return;const t=i.target,o=Object.fromEntries(new FormData(t));if(o.name||(e.value={...e.value,name:"Falta nombre"}),o.colony||(e.value={...e.value,colony:"Falta colonia"}),o.location){p.resume(),D([p.coords,p.error],([g,h])=>{if(h){e.value={...e.value,location:"Error obteniendo la ubicación"};return}y(o,g)},{once:!0});return}y(o)}return(i,t)=>(l(),s("main",L,[t[6]||(t[6]=a("h1",{class:"text-3xl font-bold mb-4"},"Agregar persona",-1)),a("form",{class:"grid grid-cols-3 gap-2 gap-y-3",onSubmit:S(x,["prevent"])},[t[2]||(t[2]=a("label",{class:"text-right",for:"name"},"Nombre",-1)),a("div",M,[a("input",{id:"name",class:u(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 w-full",e.value.name?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"text",name:"name",onInput:t[0]||(t[0]=o=>e.value.name=""),required:""},null,34),e.value.name?(l(),s("small",N,r(e.value.name),1)):d("",!0)]),t[3]||(t[3]=a("label",{class:"text-right",for:"colony"},"Colonia",-1)),a("div",Q,[a("input",{id:"colony",class:u(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 w-full",e.value.colony?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"text",name:"colony",list:"colonyList",onInput:t[1]||(t[1]=o=>e.value.colony=""),required:""},null,34),e.value.colony?(l(),s("small",j,r(e.value.colony),1)):d("",!0),a("datalist",z,[(l(!0),s(C,null,F(b(v),o=>(l(),s("option",{key:o},r(o),1))),128))])]),t[4]||(t[4]=a("label",{class:"text-right",for:"location"},"Ubicación",-1)),a("div",G,[a("input",{type:"checkbox",id:"location",class:u(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm",e.value.location?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),name:"location"},null,2),e.value.location?(l(),s("small",K,r(e.value.location),1)):d("",!0)]),t[5]||(t[5]=a("label",{class:"text-right",for:"description"},"Descripción",-1)),a("div",O,[a("textarea",{id:"description",class:u(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","resize-y min-h-16 max-h-72 w-full",e.value.description?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),rows:"8",name:"description",maxlength:"250"},null,2),e.value.description?(l(),s("small",V,r(e.value.description),1)):d("",!0)]),a("button",{class:"col-start-3 bg-asparagus-600 rounded px-2 py-1 text-lemon-50",type:"submit",disabled:b(c).isPending.value}," Guardar ",8,$)],32)]))}});export{J as default};
