import{C as H,r as w,E as J,u as N,x as T,i as d,G as $,a as W,H as X,d as Y,I as Z,b as V,c as ee,q as te,e as u,F,k as m,t as v,l as ae,f as l,w as k,J as oe,n as D,h as B,g as f,v as I,y as le,z as re,m as se,B as ne,o as i}from"./index-DuX6IK19.js";import{g as S,a as q}from"./getDateTimeForInput-BOWwtIe8.js";import{u as ue}from"./useAvailableTopics--6djl2yI.js";import{u as M}from"./useMutation-fCztBfGf.js";function _({personId:n,date:p}){return H({queryKey:w.detail(n,p),queryFn:({queryKey:c})=>J("returnVisits",[c[2],c[3]])})}function ie({personId:n,date:p}){const c=N(),{data:x}=_({personId:n,date:p});return M({mutationFn:T(()=>async s=>{var h;if(!x.value)return Promise.reject(new Error("Revisita no encontrada"));const b=x.value,g={personId:s.personId??b.personId,date:s.date??b.date,topic:(s.topic??b.topic).trim(),returnDate:s.returnDate??b.returnDate,notes:(h=s.notes??b.notes)==null?void 0:h.trim()};return d(n)!==g.personId||d(p).toISOString()!==g.date.toISOString()?(await $("returnVisits",[d(n),d(p)]),await W("returnVisits",g)):await X("returnVisits",[d(n),d(p)],g),g}),onSuccess:s=>{c.invalidateQueries({queryKey:w.list(s.personId)}),c.setQueryData(w.detail(s.personId,s.date),s),s.personId!==d(n)&&c.invalidateQueries({queryKey:w.list(n)}),(s.personId!==d(n)||s.date!==d(p))&&c.invalidateQueries({queryKey:w.detail(n,p)})}})}function de({personId:n,date:p}){const c=N();return M({mutationFn:T(()=>async()=>{await $("returnVisits",[d(n),d(p)])}),onSuccess:()=>{c.invalidateQueries({queryKey:w.list(n)}),c.removeQueries({queryKey:w.detail(n,p)})}})}const pe={class:"col-span-2"},ce=["value"],me={key:0,class:"text-chili-600"},ve={class:"col-span-2"},ye={class:"flex flex-wrap gap-2"},fe={key:0,class:"text-chili-600"},xe={key:0},be={class:"col-span-2"},ge={key:0,class:"text-chili-600"},he={id:"topicDataList"},ke={class:"col-span-2"},De={class:"flex flex-wrap gap-2"},we=["min"],Ie={key:0,class:"text-chili-600"},Te={key:0},Fe={class:"col-span-2"},Se={key:0,class:"text-chili-600"},Ue=Y({__name:"ReturnVisitsEdit",props:{id:{},date:{}},setup(n){var R,Q,U,E,K,L,P;const p=se(),c=n,x=T(()=>c.id),s=T(()=>c.date),b=ie({personId:x,date:s}),g=de({personId:x,date:s}),h=_({personId:x,date:s}),y=T(()=>h.data.value),z=ue(),A=Z(),C=T(()=>A.data.value??[]),e=V({}),a=ee({personId:(R=y.value)==null?void 0:R.personId,topic:(Q=y.value)==null?void 0:Q.topic,date:S((U=y.value)==null?void 0:U.date),time:q((E=y.value)==null?void 0:E.date),returnDate:S((K=y.value)==null?void 0:K.returnDate),returnTime:q((L=y.value)==null?void 0:L.returnDate),notes:(P=y.value)==null?void 0:P.notes});te(y,o=>{a.personId=o==null?void 0:o.personId,a.topic=o==null?void 0:o.topic,a.date=S(o==null?void 0:o.date),a.time=q(o==null?void 0:o.date),a.returnDate=S(o==null?void 0:o.returnDate),a.returnTime=q(o==null?void 0:o.returnDate),a.notes=o==null?void 0:o.notes});async function O(){try{await g.mutateAsync(),p.back()}catch(o){console.info(o)}}async function j(){if(a.personId||(e.value={...e.value,personId:"Elige a la persona"}),a.topic||(e.value={...e.value,topic:"Falta tema"}),a.date||(e.value={...e.value,date:"Falta fecha"}),a.time||(e.value={...e.value,time:"Falta hora"}),a.returnDate||(e.value={...e.value,returnDate:"Falta fecha de revisita"}),a.returnTime||(e.value={...e.value,returnTime:"Falta hora de revisita"}),!Object.values(e.value).some(Boolean))try{await b.mutateAsync({personId:a.personId,date:new Date(a.date+"T"+a.time),topic:a.topic,returnDate:new Date(a.returnDate+"T"+a.returnTime),notes:a.notes}),p.replace({name:"PeopleShow",params:{id:x.value}})}catch(o){console.info(o)}}return(o,t)=>{const G=ne("RouterLink");return i(),u("div",null,[d(h).isLoading.value?(i(),u(F,{key:0},[m("Cargando...")],64)):d(h).error.value||!y.value?(i(),u(F,{key:1},[m(v(d(h).error.value||"Error"),1)],64)):(i(),u("form",{key:2,class:"grid grid-cols-3 gap-2 gap-y-3",onSubmit:ae(j,["prevent"])},[C.value.length>1?(i(),u(F,{key:0},[t[12]||(t[12]=l("label",{class:"text-right",for:"personId"},"Persona",-1)),l("div",pe,[k(l("select",{id:"personId",class:D(["w-full h-8 px-2 py-1 border dark:text-lemon-50",e.value.personId?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),"onUpdate:modelValue":t[0]||(t[0]=r=>a.personId=r)},[(i(!0),u(F,null,B(C.value,r=>(i(),u("option",{key:r.id,value:r.id},v(r.name),9,ce))),128))],2),[[oe,a.personId]]),e.value.personId?(i(),u("small",me,v(e.value.personId),1)):f("",!0)])],64)):f("",!0),t[14]||(t[14]=l("div",{class:"text-right"},[l("label",{for:"date"},"Fecha"),m(" y "),l("label",{for:"time"},"hora")],-1)),l("div",ve,[l("div",ye,[k(l("input",{id:"date",class:D(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.date?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"date",name:"date","onUpdate:modelValue":t[1]||(t[1]=r=>a.date=r),onInput:t[2]||(t[2]=r=>e.value.date=""),required:""},null,34),[[I,a.date]]),k(l("input",{id:"time",class:D(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.time?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"time",name:"time","onUpdate:modelValue":t[3]||(t[3]=r=>a.time=r),onInput:t[4]||(t[4]=r=>e.value.time=""),required:""},null,34),[[I,a.time]])]),e.value.date||e.value.time?(i(),u("small",fe,[m(v(e.value.date)+" ",1),e.value.date&&e.value.time?(i(),u("br",xe)):f("",!0),m(" "+v(e.value.time),1)])):f("",!0)]),t[15]||(t[15]=l("label",{class:"text-right",for:"topic"},"Tema",-1)),l("div",be,[k(l("input",{id:"topic",class:D(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 w-full",e.value.topic?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"string",name:"topic","onUpdate:modelValue":t[5]||(t[5]=r=>a.topic=r),onInput:t[6]||(t[6]=r=>e.value.topic=""),list:"topicDataList",required:""},null,34),[[I,a.topic]]),e.value.topic?(i(),u("small",ge,v(e.value.topic),1)):f("",!0),l("datalist",he,[(i(!0),u(F,null,B(d(z),r=>(i(),u("option",{key:r},v(r),1))),128))])]),t[16]||(t[16]=l("div",{class:"text-right"},[l("label",{for:"returnDate"},"Fecha"),m(" y "),l("label",{for:"returnTime"},"hora"),m(" de revisita ")],-1)),l("div",ke,[l("div",De,[k(l("input",{id:"returnDate",class:D(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.returnDate?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"date",name:"returnDate","onUpdate:modelValue":t[7]||(t[7]=r=>a.returnDate=r),min:a.date,onChange:t[8]||(t[8]=r=>e.value.returnDate=""),required:""},null,42,we),[[I,a.returnDate]]),k(l("input",{id:"returnTime",class:D(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.returnTime?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"time",name:"returnTime","onUpdate:modelValue":t[9]||(t[9]=r=>a.returnTime=r),onInput:t[10]||(t[10]=r=>e.value.returnTime=""),required:""},null,34),[[I,a.returnTime]])]),e.value.returnDate||e.value.returnTime?(i(),u("small",Ie,[m(v(e.value.returnDate)+" ",1),e.value.returnDate&&e.value.returnTime?(i(),u("br",Te)):f("",!0),m(" "+v(e.value.returnTime),1)])):f("",!0)]),t[17]||(t[17]=l("label",{class:"text-right",for:"notes"},"Notas",-1)),l("div",Fe,[k(l("textarea",{id:"notes",class:D(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","resize-y min-h-16 max-h-72 w-full",e.value.notes?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),"onUpdate:modelValue":t[11]||(t[11]=r=>a.notes=r),name:"notes",rows:"10",maxlength:"500"},null,2),[[I,a.notes]]),e.value.notes?(i(),u("small",Se,v(e.value.notes),1)):f("",!0)]),le(G,{class:"col-start-2 border underline border-asparagus-600 rounded px-2 py-1 text-asparagus-600 text-center",to:{name:"PeopleShow",params:{id:o.id}}},{default:re(()=>t[13]||(t[13]=[m(" Cancelar ")])),_:1},8,["to"]),t[18]||(t[18]=l("button",{class:"bg-asparagus-600 rounded px-2 py-1 text-lemon-50",type:"submit"}," Guardar ",-1)),l("button",{class:"col-start-2 bg-fawn-600 rounded px-2 py-1 text-fawn-50 text-center",onClick:O,type:"button"}," Eliminar ")],32))])}}});export{Ue as default};
