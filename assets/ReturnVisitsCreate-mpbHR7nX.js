import{u as C,k as U,r as x,f as y,a as R,d as I,v as T,c as g,b as s,g as p,e as i,F as S,s as L,m as A,w as B,h as E,q as N,o as D,t as Q}from"./index-CRgsI8ii.js";import{u as M,_ as d,b as V,a as $}from"./VTextarea.vue_vue_type_script_setup_true_lang-Bq3UuHX3.js";import{u as h,g as w,a as F}from"./getDateTimeForInput-B7rWynE8.js";function K({personId:f}){const u=C();return M({mutationFn:U(()=>async o=>{var l;const n={personId:y(f),date:o.date,returnDate:o.returnDate,topic:o.topic.trim(),notes:(l=o.notes)==null?void 0:l.trim()};return await R("returnVisits",n),n}),onSuccess:o=>{u.invalidateQueries({queryKey:x.list(o.personId)}),u.setQueryData(x.detail(o.personId,o.date),o)}})}const P={class:"col-span-2"},j={class:"flex flex-wrap gap-2"},z={id:"topicDataList"},G={class:"col-span-2"},O={class:"flex flex-wrap gap-2"},H=["disabled"],Y=I({__name:"ReturnVisitsCreate",props:{id:{}},setup(f){const u=E(),o=f,n=U(()=>o.id),l=K({personId:n}),q=h(),c=new Date,b=new Date(c.getTime()+7*24*60*60*1e3),r=T({date:w(c),time:F(c),topic:"",returnDate:w(b),returnTime:F(b),notes:""}),a=T({});async function k(){r.date||(a.date="Falta fecha"),r.time||(a.time="Falta hora"),r.topic||(a.topic="Falta tema"),r.returnDate||(a.returnDate="Falta fecha de revisita"),r.returnTime||(a.returnTime="Falta hora de revisita");const v=new Date(r.date+"T"+r.time),e=new Date(r.returnDate+"T"+r.returnTime);if(v.getTime()>e.getTime()&&(a.returnDate="Fecha de revisita tiene que ser posterior a fecha de visita"),!Object.values(a).some(Boolean))try{await l.mutateAsync({date:v,topic:r.topic,returnDate:e,notes:r.notes}),u.back()}catch(m){a.time=m instanceof Error?m.message:"Error desconocido"}}return(v,e)=>{const m=N("RouterLink");return D(),g("form",{class:"grid grid-cols-3 gap-2 gap-y-3",onSubmit:B(k,["prevent"])},[e[13]||(e[13]=s("div",{class:"text-right"},[s("label",{for:"date"},"Fecha"),p(" y "),s("label",{for:"time"},"hora")],-1)),s("div",P,[s("div",j,[i(d,{"div-class":"flex-1",id:"date",type:"date",modelValue:r.date,"onUpdate:modelValue":e[0]||(e[0]=t=>r.date=t),errors:a.date,"onUpdate:errors":e[1]||(e[1]=t=>a.date=t),"hide-errors":"",required:""},null,8,["modelValue","errors"]),i(d,{"div-class":"flex-1",id:"time",type:"time",modelValue:r.time,"onUpdate:modelValue":e[2]||(e[2]=t=>r.time=t),errors:a.time,"onUpdate:errors":e[3]||(e[3]=t=>a.time=t),"hide-errors":"",required:""},null,8,["modelValue","errors"])]),i(V,{errors:[a.date,a.time]},null,8,["errors"])]),e[14]||(e[14]=s("label",{class:"text-right",for:"topic"},"Tema",-1)),i(d,{"div-class":"col-span-2",id:"topic",modelValue:r.topic,"onUpdate:modelValue":e[4]||(e[4]=t=>r.topic=t),errors:a.topic,"onUpdate:errors":e[5]||(e[5]=t=>a.topic=t),placeholder:"En esta visita hablamos de...",list:"topicDataList",required:""},null,8,["modelValue","errors"]),s("datalist",z,[(D(!0),g(S,null,L(y(q),t=>(D(),g("option",{key:t},Q(t),1))),128))]),e[15]||(e[15]=s("div",{class:"text-right"},[s("label",{for:"returnDate"},"Fecha"),p(" y "),s("label",{for:"returnTime"},"hora"),p(" de revisita ")],-1)),s("div",G,[s("div",O,[i(d,{id:"returnDate","div-class":"flex-1",type:"date",modelValue:r.returnDate,"onUpdate:modelValue":e[6]||(e[6]=t=>r.returnDate=t),min:r.date,errors:a.returnDate,"onUpdate:errors":e[7]||(e[7]=t=>a.returnDate=t),"hide-errors":"",required:""},null,8,["modelValue","min","errors"]),i(d,{id:"returnTime","div-class":"flex-1",type:"time",modelValue:r.returnTime,"onUpdate:modelValue":e[8]||(e[8]=t=>r.returnTime=t),errors:a.returnTime,"onUpdate:errors":e[9]||(e[9]=t=>a.returnTime=t),"hide-errors":"",required:""},null,8,["modelValue","errors"])]),i(V,{errors:[a.returnDate,a.returnTime]},null,8,["errors"])]),e[16]||(e[16]=s("label",{class:"text-right",for:"notes"},"Notas",-1)),i($,{"div-class":"col-span-2",id:"notes",class:"resize-y min-h-16 max-h-72",placeholder:"QuedÃ© en volver para platicar sobre...",modelValue:r.notes,"onUpdate:modelValue":e[10]||(e[10]=t=>r.notes=t),errors:a.notes,"onUpdate:errors":e[11]||(e[11]=t=>a.notes=t)},null,8,["modelValue","errors"]),i(m,{class:"col-start-2 border underline border-asparagus-600 rounded px-2 py-1 text-asparagus-600 text-center",to:{name:"PeopleShow",params:{id:n.value}}},{default:A(()=>e[12]||(e[12]=[p(" Cancelar ")])),_:1},8,["to"]),s("button",{class:"col-start-3 bg-asparagus-600 rounded px-2 py-1 text-lemon-50",type:"submit",disabled:y(l).isPending.value}," Guardar ",8,H)],32)}}});export{Y as default};
