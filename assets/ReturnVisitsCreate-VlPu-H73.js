import{u as R,k as T,r as b,f as t,a as q,d as C,W as x,i as k,c as S,b as o,g as f,e as i,_ as w,m as A,w as E,h as N,q as P,o as Q}from"./index-D6IdYIOx.js";import{u as B}from"./useMutation-BFuSot1U.js";import{u as M,g as c,a as v}from"./getDateTimeForInput-CEVL2o50.js";import{u as K,_ as u,a as L}from"./VTextarea.vue_vue_type_script_setup_true_lang-TlYwyJ6E.js";import{u as $}from"./usePersonReturnVisits-9qNjFtH_.js";import"./useReturnVisits-BBX5RBm0.js";function h({personId:D}){const m=R();return B({mutationFn:T(()=>async a=>{var p;const l={personId:t(D),date:a.date,returnDate:a.returnDate,topic:a.topic.trim(),notes:(p=a.notes)==null?void 0:p.trim()};return await q("returnVisits",l),l}),onSuccess:a=>{m.invalidateQueries({queryKey:b.list(a.personId)}),m.setQueryData(b.detail(a.personId,a.date),a)}})}const W={class:"col-span-2"},j={class:"flex flex-wrap gap-2"},z={class:"col-span-2"},G={class:"flex flex-wrap gap-2"},O=["disabled"],ee=C({__name:"ReturnVisitsCreate",props:{id:{}},setup(D){const m=N(),a=D,l=T(()=>a.id),p=$({personId:l}),g=h({personId:l}),F=M(),U=T(()=>{var n;return(n=p.data.value)==null?void 0:n.at(0)}),y=new Date,V=new Date(y.getTime()+x),e=K({date:c(y),time:v(y),topic:"",returnDate:c(V),returnTime:v(V),notes:""});k(U,n=>{if(!n)return;const r=n.returnDate;e.date=c(r),e.time=v(r);const d=new Date(r.getTime()+x);e.returnDate=c(d),e.returnTime=v(d)});async function I(){if(g.isPending.value)return;e.date||(e.errors.date="Falta fecha"),e.time||(e.errors.time="Falta hora"),e.topic||(e.errors.topic="Falta tema"),e.returnDate||(e.errors.returnDate="Falta fecha de revisita"),e.returnTime||(e.errors.returnTime="Falta hora de revisita");const n=new Date(e.date+"T"+e.time),r=new Date(e.returnDate+"T"+e.returnTime);if(n.getTime()>r.getTime()&&(e.errors.returnDate="Fecha de revisita tiene que ser posterior a fecha de visita"),!Object.values(e.errors).some(Boolean))try{await g.mutateAsync({date:n,topic:e.topic,returnDate:r,notes:e.notes}),m.back()}catch(d){console.info(d),alert(`Error guardando los datos
Por favor intenta de nuevo`)}}return(n,r)=>{const d=P("RouterLink");return Q(),S("form",{class:"grid grid-cols-3 gap-2 gap-y-3",onSubmit:E(I,["prevent"])},[r[13]||(r[13]=o("div",{class:"text-right"},[o("label",{for:"date"},"Fecha"),f(" y "),o("label",{for:"time"},"hora")],-1)),o("div",W,[o("div",j,[i(u,{id:"date","div-class":"flex-1",type:"date",modelValue:t(e).date,"onUpdate:modelValue":r[0]||(r[0]=s=>t(e).date=s),errors:t(e).errors.date,"onUpdate:errors":r[1]||(r[1]=s=>t(e).errors.date=s),"hide-errors":"",required:""},null,8,["modelValue","errors"]),i(u,{id:"time","div-class":"flex-1",type:"time",modelValue:t(e).time,"onUpdate:modelValue":r[2]||(r[2]=s=>t(e).time=s),errors:t(e).errors.time,"onUpdate:errors":r[3]||(r[3]=s=>t(e).errors.time=s),"hide-errors":"",required:""},null,8,["modelValue","errors"])]),i(w,{errors:[t(e).errors.date,t(e).errors.time]},null,8,["errors"])]),r[14]||(r[14]=o("label",{class:"text-right",for:"topic"},"Tema",-1)),i(u,{id:"topic","div-class":"col-span-2",modelValue:t(e).topic,"onUpdate:modelValue":r[4]||(r[4]=s=>t(e).topic=s),errors:t(e).errors.topic,"onUpdate:errors":r[5]||(r[5]=s=>t(e).errors.topic=s),placeholder:"En esta visita hablamos de...",list:t(F),required:""},null,8,["modelValue","errors","list"]),r[15]||(r[15]=o("div",{class:"text-right"},[o("label",{for:"returnDate"},"Fecha"),f(" y "),o("label",{for:"returnTime"},"hora"),f(" de revisita ")],-1)),o("div",z,[o("div",G,[i(u,{id:"returnDate","div-class":"flex-1",type:"date",modelValue:t(e).returnDate,"onUpdate:modelValue":r[6]||(r[6]=s=>t(e).returnDate=s),errors:t(e).errors.returnDate,"onUpdate:errors":r[7]||(r[7]=s=>t(e).errors.returnDate=s),min:t(e).date,"hide-errors":"",required:""},null,8,["modelValue","errors","min"]),i(u,{id:"returnTime","div-class":"flex-1",type:"time",modelValue:t(e).returnTime,"onUpdate:modelValue":r[8]||(r[8]=s=>t(e).returnTime=s),errors:t(e).errors.returnTime,"onUpdate:errors":r[9]||(r[9]=s=>t(e).errors.returnTime=s),"hide-errors":"",required:""},null,8,["modelValue","errors"])]),i(w,{errors:[t(e).errors.returnDate,t(e).errors.returnTime]},null,8,["errors"])]),r[16]||(r[16]=o("label",{class:"text-right",for:"notes"},"Notas",-1)),i(L,{id:"notes","div-class":"col-span-2",class:"resize-y min-h-16 max-h-72",placeholder:"QuedÃ© en volver para platicar sobre...",modelValue:t(e).notes,"onUpdate:modelValue":r[10]||(r[10]=s=>t(e).notes=s),errors:t(e).errors.notes,"onUpdate:errors":r[11]||(r[11]=s=>t(e).errors.notes=s)},null,8,["modelValue","errors"]),i(d,{class:"col-start-2 border underline border-asparagus-600 rounded px-2 py-1 text-asparagus-600 text-center",to:{name:"PeopleShow",params:{personId:l.value}}},{default:A(()=>r[12]||(r[12]=[f(" Cancelar ")])),_:1},8,["to"]),o("button",{class:"col-start-3 bg-asparagus-600 rounded px-2 py-1 text-lemon-50",type:"submit",disabled:t(g).isPending.value}," Guardar ",8,O)],32)}}});export{ee as default};
