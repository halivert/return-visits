import{u as R,k as y,g as V,a as F,d as L,r as g,c as s,b as a,l as i,x as S,y as _,n as d,t as l,e as c,F as M,f as N,m as $,q as E,w as O,h as Q,v as z,o as n}from"./index-CO114ncd.js";import{u as B}from"./useMutation-2VRqEHlr.js";import{r as I}from"./returnVisitsKeys-BjL7tDZc.js";import{u as A}from"./usePersonReturnVisits-CqAZsNFP.js";function K({personId:f}){const v=R();return B({mutationFn:y(()=>async o=>{const u={personId:V(f),...o};return await F("returnVisits",u),u}),onSuccess:o=>{v.invalidateQueries({queryKey:I.list(o.personId)}),v.setQueryData(I.detail(o.personId,o.date),o)}})}const U={class:"col-span-2"},j={class:"flex flex-wrap gap-2"},G={key:0,class:"text-chili-600"},H={key:0},J={class:"col-span-2"},W={key:0,class:"text-chili-600"},X={id:"topicDataList"},Y={class:"col-span-2"},Z={class:"flex flex-wrap gap-2"},ee=["min"],te={key:0,class:"text-chili-600"},ae={key:0},re={class:"col-span-2"},se={key:0,class:"text-chili-600"},ne=["disabled"],de=L({__name:"ReturnVisitsCreate",props:{id:{}},setup(f){const v=Q(),o=f,u=y(()=>o.id),C=A({personId:u}),h=K({personId:u}),e=g({}),q=y(()=>{var m;return new Set((m=C.data.value)==null?void 0:m.map(({topic:t})=>t))}),p=new Date,w=p.getTimezoneOffset(),x=g(new Date(p.getTime()-w*60*1e3).toISOString().split("T")[0]),k=g(new Date(p.getTime()-w*60*1e3+7*24*60*60*1e3).toISOString().split("T")[0]),D=p.getHours().toString().padStart(2,"0")+":"+p.getMinutes().toString().padStart(2,"0");async function P(m){const t=Object.fromEntries(new FormData(m.target));t.date||(e.value={...e.value,date:"Por favor selecciona una fecha"}),t.time||(e.value={...e.value,time:"Por favor selecciona una hora"}),t.topic||(e.value={...e.value,topic:"Por favor escribe un tema"}),t.returnDate||(e.value={...e.value,returnDate:"Por favor selecciona una fecha de revisita"}),t.returnTime||(e.value={...e.value,returnTime:"Por favor selecciona una fecha de revisita"});const b=new Date(t.date+"T"+t.time),r=new Date(t.returnDate+"T"+t.returnTime);try{await h.mutateAsync({date:b,topic:t.topic,returnDate:r,notes:t.notes}),v.back()}catch(T){e.value={...e.value,time:T instanceof Error?T.message:"Error desconocido"}}}return(m,t)=>{const b=z("RouterLink");return n(),s("form",{class:"grid grid-cols-3 gap-2 gap-y-3",onSubmit:O(P,["prevent"])},[t[8]||(t[8]=a("div",{class:"text-right"},[a("label",{for:"date"},"Fecha"),i(" y "),a("label",{for:"time"},"hora")],-1)),a("div",U,[a("div",j,[S(a("input",{id:"date",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.date?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"date",name:"date","onUpdate:modelValue":t[0]||(t[0]=r=>x.value=r),onInput:t[1]||(t[1]=r=>e.value.date=""),required:""},null,34),[[_,x.value]]),a("input",{id:"time",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.time?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"time",name:"time",value:D,onInput:t[2]||(t[2]=r=>e.value.time=""),required:""},null,34)]),e.value.date||e.value.time?(n(),s("small",G,[i(l(e.value.date)+" ",1),e.value.date&&e.value.time?(n(),s("br",H)):c("",!0),i(" "+l(e.value.time),1)])):c("",!0)]),t[9]||(t[9]=a("label",{class:"text-right",for:"topic"},"Tema",-1)),a("div",J,[a("input",{id:"topic",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 w-full",e.value.topic?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"string",name:"topic",onInput:t[3]||(t[3]=r=>e.value.topic=""),list:"topicDataList",required:""},null,34),e.value.topic?(n(),s("small",W,l(e.value.topic),1)):c("",!0),a("datalist",X,[(n(!0),s(M,null,N(q.value,r=>(n(),s("option",{key:r},l(r),1))),128))])]),t[10]||(t[10]=a("div",{class:"text-right"},[a("label",{for:"returnDate"},"Fecha"),i(" y "),a("label",{for:"returnTime"},"hora"),i(" de revisita ")],-1)),a("div",Y,[a("div",Z,[S(a("input",{id:"returnDate",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.returnDate?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"date",name:"returnDate","onUpdate:modelValue":t[4]||(t[4]=r=>k.value=r),min:x.value,onChange:t[5]||(t[5]=r=>e.value.returnDate=""),required:""},null,42,ee),[[_,k.value]]),a("input",{id:"returnTime",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","h-8 flex-1",e.value.returnTime?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),type:"time",name:"returnTime",value:D,onInput:t[6]||(t[6]=r=>e.value.returnTime=""),required:""},null,34)]),e.value.returnDate||e.value.returnTime?(n(),s("small",te,[i(l(e.value.returnDate)+" ",1),e.value.returnDate&&e.value.returnTime?(n(),s("br",ae)):c("",!0),i(" "+l(e.value.returnTime),1)])):c("",!0)]),t[11]||(t[11]=a("label",{class:"text-right",for:"notes"},"Notas",-1)),a("div",re,[a("textarea",{id:"notes",class:d(["block dark:text-lemon-50 px-2 py-1 max-w-full rounded-sm border","resize-y min-h-16 max-h-72 w-full",e.value.notes?"border-chili-400 accent-chili-600":"border-asparagus-100 accent-asparagus-600"]),rows:"8",name:"notes",maxlength:"250"},null,2),e.value.notes?(n(),s("small",se,l(e.value.notes),1)):c("",!0)]),$(b,{class:"col-start-2 border underline border-asparagus-600 rounded px-2 py-1 text-asparagus-600 text-center",to:{name:"PeopleShow",params:{id:u.value}}},{default:E(()=>t[7]||(t[7]=[i(" Cancelar ")])),_:1},8,["to"]),a("button",{class:"col-start-3 bg-asparagus-600 rounded px-2 py-1 text-lemon-50",type:"submit",disabled:V(h).isPending.value}," Guardar ",8,ne)],32)}}});export{de as default};
